---
layout: default
---

<div class="row">
  <!-- Main content -->
  <div class="col-lg-8">
    <h1 class="mb-1">{{ page.title }}</h1>
    {% if page.description %}
    <p class="lead text-muted mb-4">{{ page.description }}</p>
    {% endif %}

    <!-- Resources -->
    {% if page.resources %}
    <h2 class="h5 mb-3">Resources</h2>
    <div class="list-group mb-4">
      {% for resource in page.resources %}
      <div class="list-group-item d-flex align-items-center gap-3">
        <i class="bi bi-file-earmark-arrow-down fs-4 text-primary flex-shrink-0"></i>
        <div class="flex-grow-1">
          <div class="fw-semibold">{{ resource.name | default: resource.url }}</div>
          {% if resource.format %}
          <small class="text-muted">Format: {{ resource.format }}</small>
          {% endif %}
          {% if resource.description %}
          <small class="text-muted d-block">{{ resource.description }}</small>
          {% endif %}
        </div>
        <div class="d-flex gap-2 flex-shrink-0">
          <a href="{{ resource.url }}" class="btn btn-sm btn-outline-primary"
             target="_blank" rel="noopener noreferrer">
            Download CSV
          </a>
          {% assign fmt = resource.format | downcase %}
          {% if fmt == "csv" or resource.url contains ".csv" %}
          <button class="btn btn-sm btn-outline-success"
                  data-csv-url="{{ resource.url }}"
                  data-filename="{{ page.slug }}.xlsx"
                  onclick="downloadXlsx(this)">
            Download XLSX
          </button>
          {% endif %}
        </div>
      </div>
      {% endfor %}
    </div>
    {% endif %}

    <!-- Data preview -->
    {% if page.preview %}
      {% assign _preview_path = "previews/" | append: page.preview | append: ".html" %}
      <h2 class="h5 mb-3">Data Preview</h2>
      <div class="preview-table-wrapper mb-4">
        {% include {{ _preview_path }} %}
      </div>
    {% endif %}

    <!-- Page body content (if any) -->
    {% if content != "" %}
    <div class="mt-4">{{ content }}</div>
    {% endif %}
  </div>

  <!-- Sidebar -->
  <div class="col-lg-4">
    <div class="card">
      <div class="card-header fw-semibold">Dataset Information</div>
      <div class="card-body p-0">
        <table class="table table-sm meta-table mb-0">
          <tbody>
            {% for field in site.data.schemas.default.fields %}
              {% assign field_value = page[field.key] %}
              {% if field_value %}
              <tr>
                <th class="ps-3 py-2 text-muted fw-normal">{{ field.label }}</th>
                <td class="pe-3 py-2">
                  {% if field.key == "maintainer_email" %}
                    <a href="mailto:{{ field_value }}">{{ field_value }}</a>
                  {% elsif field_value contains "http" %}
                    <a href="{{ field_value }}" target="_blank" rel="noopener noreferrer">{{ field_value }}</a>
                  {% elsif field_value.first %}
                    {{ field_value | join: ", " }}
                  {% else %}
                    {{ field_value }}
                  {% endif %}
                </td>
              </tr>
              {% endif %}
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- SheetJS â€” loaded only on dataset pages -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"
  integrity="sha512-r22gChDnGvBylk90+2e/ycr3RVrDi8DIOkIGNhJlKfuyQM4tIRAI062MaV8sfjQKYVGjOBaZBOA87z+IhZE9DA=="
  crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script>
function downloadXlsx(btn) {
  var url = btn.getAttribute('data-csv-url');
  var filename = btn.getAttribute('data-filename');
  var original = btn.textContent;

  btn.disabled = true;
  btn.textContent = 'Preparing\u2026';

  fetch(url)
    .then(function(r) {
      if (!r.ok) throw new Error('HTTP ' + r.status);
      return r.text();
    })
    .then(function(csv) {
      var wb = XLSX.read(csv, { type: 'string' });
      XLSX.writeFile(wb, filename);
    })
    .catch(function() {
      alert('Could not download the file. Check that the resource URL is publicly accessible.');
    })
    .finally(function() {
      btn.disabled = false;
      btn.textContent = original;
    });
}
</script>
